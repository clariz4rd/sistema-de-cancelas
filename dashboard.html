<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body { background: #b3bcd3; transition: 0.3s ease; }
        .sidebar {
            min-width: 240px; max-width: 240px; height: 100vh;
            background:#dee3ec; border-right: 1px solid #f4f8ff;
            padding-top: 25px; position: fixed; left: 0; top: 0;
            transition: 0.3s ease;
        }
        .sidebar:hover { background:#d6dcec; }
        .sidebar .nav-link {
            font-size: 15px; padding: 12px 20px;
            color:#434446; transition: 0.2s ease;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background: hsl(240, 15%, 87%); color: #2049ee;
            border-radius: 8px; transform: translateX(4px);
        }
        .logout { position: fixed; top: 15px; right: 20px; font-size: 25px; }
        .logout a { color: #434446; text-decoration: none; transition: 0.2s ease; }
        .logout a:hover { color: #2049ee; transform: scale(1.15); }
        .content { margin-left: 260px; padding: 25px; }
        .card-dashboard {
            background: #fff; padding: 22px; border-radius: 14px;
            box-shadow: 0 0 12px rgba(0,0,0,0.08); transition: .3s ease;
        }
        .card-dashboard:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 18px rgba(0,0,0,0.12);
        }
        .number { font-size: 32px; font-weight: bold; }
        .progress { height: 12px; border-radius: 8px; }
    </style>
</head>

<body>

    <div class="logout">
        <a href="cadastro.html"><i class="bi bi-box-arrow-right"></i></a>
    </div>

    <div class="sidebar">
        <h6 class="px-3 mb-4"><i class="bi bi-key-fill me-2"></i> Sistema de Controle de Cancelas</h6>
        <nav class="nav flex-column">
            <a class="nav-link active" href="dashboard.html"><i class="bi bi-house me-2"></i>Dashboard</a>
            <a class="nav-link" href="veiculo.html"><i class="bi bi-car-front me-2"></i>Veículos</a>
            <a class="nav-link" href="conta_saldos.html"><i class="bi bi-wallet2 me-2"></i>Contas / Saldos</a>
            <a class="nav-link" href="relatorios.html"><i class="bi bi-file-bar-graph me-2"></i>Relatórios</a>
        </nav>
    </div>

    <div class="content">

        <h3 class="fw-bold">Dashboard</h3>
        <p class="text-muted">Visão geral do sistema</p>

        <div class="row mt-4">
            <div class="col-md-4">
                <div class="card-dashboard">
                    <h6 class="text-muted">Veículos no estacionamento</h6>
                    <div class="number" id="totalVeiculos">0</div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card-dashboard">
                    <h6 class="text-muted">Total de entradas hoje</h6>
                    <div class="number" id="entradasHoje">0</div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card-dashboard">
                    <h6 class="text-muted">Total de saídas hoje</h6>
                    <div class="number" id="saidasHoje">0</div>
                </div>
            </div>
        </div>

        <div class="card-dashboard mt-4">
            <h6 class="fw-bold mb-2">Taxa de Ocupação</h6>
            <div class="progress mb-1">
                <div class="progress-bar bg-primary" id="ocupacaoBar" style="width: 0%;"></div>
            </div>
            <div class="d-flex justify-content-between">
                <span class="text-muted">0%</span>
                <span class="text-muted">100%</span>
            </div>
        </div>

        <div class="card-dashboard mt-4">
            <h6 class="fw-bold mb-3">Últimas Movimentações</h6>
            <table class="table" id="tabelaMov">
                <thead>
                    <tr>
                        <th>Placa</th>
                        <th>Tipo</th>
                        <th>Horário</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="movimentacoesBody"></tbody>
            </table>
        </div>

    </div>

<script>
function atualizarTotal() {
    let veiculos = JSON.parse(localStorage.getItem("veiculos")) || [];
    document.getElementById("totalVeiculos").innerText = veiculos.length;
}
atualizarTotal();

const placas = ["ABC-1234", "XYZ-5678", "BRA-2024", "KLM-9087", "JQW-4455", "RTY-8899"];
const tipos = ["Funcionário", "Visitante", "Aluno", "Professor"];
const statusLista = [
    { texto: "Entrada", cor: "text-success" },
    { texto: "Saída", cor: "text-danger" }
];

const transacoes = [
    "Cobrança de Estacionamento",
    "Crédito de Recarga",
    "Ajuste de Saldo",
    "Taxa Especial",
    "Regularização de Débito"
];

let entradasHoje = 40;
let saidasHoje = 50;

function horaAtual() {
    let d = new Date();
    return d.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" });
}

function gerarMov() {

    const escolher = Math.random();
    let placa = "-";
    let tipo = "-";
    let statusTexto = "";
    let statusCor = "";

    if (escolher < 0.60) {
        placa = placas[Math.floor(Math.random()*placas.length)];
        tipo = tipos[Math.floor(Math.random()*tipos.length)];
        const s = statusLista[Math.floor(Math.random()*statusLista.length)];
        statusTexto = s.texto;
        statusCor = s.cor;

        if (statusTexto === "Entrada") entradasHoje++;
        else saidasHoje++;

        document.getElementById("entradasHoje").innerText = entradasHoje;
        document.getElementById("saidasHoje").innerText = saidasHoje;

        atualizarOcupacao();

    } else {
        const descricao = transacoes[Math.floor(Math.random()*transacoes.length)];
        const valor = (Math.random()*180 + 20).toFixed(2);
        statusTexto = `${descricao} - R$ ${valor}`;
        statusCor = "text-primary";
    }

    const linha = `
        <tr>
            <td>${placa}</td>
            <td>${tipo}</td>
            <td>${horaAtual()}</td>
            <td><span class="${statusCor}">${statusTexto}</span></td>
        </tr>`;

    const body = document.getElementById("movimentacoesBody");
    body.insertAdjacentHTML("afterbegin", linha);

    while (body.rows.length > 60) {
        body.deleteRow(body.rows.length - 1);
    }
}

function atualizarOcupacao() {
    let totalVagas = 100;

    let veiculos = JSON.parse(localStorage.getItem("veiculos")) || [];
    let totalVeiculos = veiculos.length;

    let porcentagem = Math.round((totalVeiculos / totalVagas) * 100);

    if (porcentagem < 0) porcentagem = 0;
    if (porcentagem > 100) porcentagem = 100;

    document.getElementById("ocupacaoBar").style.width = porcentagem + "%";
}


setInterval(() => gerarMov(), Math.random()*9000 + 10000);

for (let i = 0; i < 3; i++) gerarMov();
</script>

</body>
</html>
